<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>noisyR count matrix approach workflow</title>


<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">noisyR count matrix approach workflow</h1>


<div id="TOC">
<ul>
<li><a href="#installation"><span class="toc-section-number">1</span> Installation</a></li>
<li><a href="#preprocessing"><span class="toc-section-number">2</span> Preprocessing</a></li>
<li><a href="#running-noisyr"><span class="toc-section-number">3</span> Running <em>noisyR</em></a></li>
<li><a href="#pipeline-breakdown"><span class="toc-section-number">4</span> Pipeline breakdown</a><ul>
<li><a href="#similarity-calculation"><span class="toc-section-number">4.1</span> Similarity calculation</a></li>
<li><a href="#noise-quantification"><span class="toc-section-number">4.2</span> Noise quantification</a></li>
<li><a href="#noise-removal"><span class="toc-section-number">4.3</span> Noise removal</a></li>
</ul></li>
<li><a href="#downstream-analysis"><span class="toc-section-number">5</span> Downstream analysis</a></li>
</ul>
</div>

<p>The <em>noisyR</em> package is an end-to-end pipeline for quantifying and removing technical noise from HTS datasets. The three main pipeline steps are:</p>
<ol style="list-style-type: decimal">
<li>similarity calculation<br />
</li>
<li>noise quantification<br />
</li>
<li>noise removal</li>
</ol>
<p>Each step can be finely tuned using hyperparameters; optimal, data-driven values for these parameters are also determined.</p>
<p>The package and some applications are described in more detail in <a href="https://www.biorxiv.org/content/10.1101/2021.01.17.427026v2">this paper</a> and is actively maintained on <a href="https://github.com/Core-Bioinformatics/noisyR" class="uri">https://github.com/Core-Bioinformatics/noisyR</a>.</p>
<p>The <strong>count matrix approach</strong> uses the original, un-normalised count matrix, as provided after alignment and feature quantification; each sample is processed individually, only the relative expressions across samples are compared. Relying on the hypothesis that the majority of genes are not DE, most of the evaluations are expected to point towards a high similarity across samples.</p>
<div id="installation" class="section level1">
<h1><span class="header-section-number">1</span> Installation</h1>
<p>To install the package, first install all bioconductor dependencies:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1">packages.bioc &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;preprocessCore&quot;</span>,</a>
<a class="sourceLine" id="cb1-2" title="2">                   <span class="st">&quot;IRanges&quot;</span>,</a>
<a class="sourceLine" id="cb1-3" title="3">                   <span class="st">&quot;GenomicRanges&quot;</span>,</a>
<a class="sourceLine" id="cb1-4" title="4">                   <span class="st">&quot;Rsamtools&quot;</span>)</a>
<a class="sourceLine" id="cb1-5" title="5">new.packages.bioc &lt;-<span class="st"> </span>packages.bioc[<span class="op">!</span>(packages.bioc <span class="op">%in%</span><span class="st"> </span><span class="kw">installed.packages</span>()[,<span class="st">&quot;Package&quot;</span>])]</a>
<a class="sourceLine" id="cb1-6" title="6"><span class="cf">if</span>(<span class="kw">length</span>(new.packages.bioc)){</a>
<a class="sourceLine" id="cb1-7" title="7">  <span class="cf">if</span> (<span class="op">!</span><span class="kw">requireNamespace</span>(<span class="st">&quot;BiocManager&quot;</span>, <span class="dt">quietly =</span> <span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb1-8" title="8">    <span class="kw">install.packages</span>(<span class="st">&quot;BiocManager&quot;</span>)</a>
<a class="sourceLine" id="cb1-9" title="9">  BiocManager<span class="op">::</span><span class="kw">install</span>(new.packages.bioc)</a>
<a class="sourceLine" id="cb1-10" title="10">}</a></code></pre></div>
<p>Then, you can install <em>noisyR</em> (and all its other dependencies) from CRAN:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1"><span class="kw">install.packages</span>(<span class="st">&quot;noisyr&quot;</span>)</a></code></pre></div>
<p>To install the latest stable version from GitHub, first install CRAN dependencies:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1">packages.cran &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;utils&quot;</span>,</a>
<a class="sourceLine" id="cb3-2" title="2">                   <span class="st">&quot;grDevices&quot;</span>,</a>
<a class="sourceLine" id="cb3-3" title="3">                   <span class="st">&quot;tibble&quot;</span>,</a>
<a class="sourceLine" id="cb3-4" title="4">                   <span class="st">&quot;dplyr&quot;</span>,</a>
<a class="sourceLine" id="cb3-5" title="5">                   <span class="st">&quot;magrittr&quot;</span>,</a>
<a class="sourceLine" id="cb3-6" title="6">                   <span class="st">&quot;ggplot2&quot;</span>,</a>
<a class="sourceLine" id="cb3-7" title="7">                   <span class="st">&quot;philentropy&quot;</span>,</a>
<a class="sourceLine" id="cb3-8" title="8">                   <span class="st">&quot;doParallel&quot;</span>,</a>
<a class="sourceLine" id="cb3-9" title="9">                   <span class="st">&quot;foreach&quot;</span>)</a>
<a class="sourceLine" id="cb3-10" title="10">new.packages.cran &lt;-<span class="st"> </span>packages.cran[<span class="op">!</span>(packages.cran <span class="op">%in%</span><span class="st"> </span><span class="kw">installed.packages</span>()[,<span class="st">&quot;Package&quot;</span>])]</a>
<a class="sourceLine" id="cb3-11" title="11"><span class="cf">if</span>(<span class="kw">length</span>(new.packages.cran))</a>
<a class="sourceLine" id="cb3-12" title="12">  <span class="kw">install.packages</span>(new.packages.cran)</a>
<a class="sourceLine" id="cb3-13" title="13"></a>
<a class="sourceLine" id="cb3-14" title="14"><span class="cf">if</span> (<span class="op">!</span><span class="kw">requireNamespace</span>(<span class="st">&quot;devtools&quot;</span>, <span class="dt">quietly =</span> <span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb3-15" title="15">  <span class="kw">install.packages</span>(<span class="st">&quot;devtools&quot;</span>)</a>
<a class="sourceLine" id="cb3-16" title="16">devtools<span class="op">::</span><span class="kw">install_github</span>(<span class="st">&quot;Core-Bioinformatics/noisyR&quot;</span>)</a></code></pre></div>
</div>
<div id="preprocessing" class="section level1">
<h1><span class="header-section-number">2</span> Preprocessing</h1>
<p>First, load <em>noisyR</em>:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1"><span class="kw">library</span>(noisyr)</a></code></pre></div>
<p>For this demonstration we will be using a subset of the count matrix for an experiment included in <a href="https://www.sciencedirect.com/science/article/pii/S2405471219301152">a 2019 paper by Yang et al</a>. Rows represent genes/features and columns represent samples:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1">counts.in &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="st">&quot;extdata&quot;</span>, <span class="st">&quot;counts_raw.csv&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;noisyr&quot;</span>)</a>
<a class="sourceLine" id="cb5-2" title="2">df &lt;-<span class="st"> </span><span class="kw">read.csv</span>(counts.in, <span class="dt">row.names =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb5-3" title="3"><span class="kw">str</span>(df)</a>
<a class="sourceLine" id="cb5-4" title="4"><span class="co">#&gt; &#39;data.frame&#39;:    55573 obs. of  4 variables:</span></a>
<a class="sourceLine" id="cb5-5" title="5"><span class="co">#&gt;  $ SRR7624365: int  2 0 6 0 0 0 0 0 0 0 ...</span></a>
<a class="sourceLine" id="cb5-6" title="6"><span class="co">#&gt;  $ SRR7624366: int  0 0 4 0 0 0 0 0 0 0 ...</span></a>
<a class="sourceLine" id="cb5-7" title="7"><span class="co">#&gt;  $ SRR7624371: int  0 0 2 0 2 0 0 0 0 0 ...</span></a>
<a class="sourceLine" id="cb5-8" title="8"><span class="co">#&gt;  $ SRR7624372: int  0 0 0 0 0 2 0 0 0 0 ...</span></a>
<a class="sourceLine" id="cb5-9" title="9"><span class="kw">head</span>(df)</a>
<a class="sourceLine" id="cb5-10" title="10"><span class="co">#&gt;                    SRR7624365 SRR7624366 SRR7624371 SRR7624372</span></a>
<a class="sourceLine" id="cb5-11" title="11"><span class="co">#&gt; ENSMUSG00000102693          2          0          0          0</span></a>
<a class="sourceLine" id="cb5-12" title="12"><span class="co">#&gt; ENSMUSG00000064842          0          0          0          0</span></a>
<a class="sourceLine" id="cb5-13" title="13"><span class="co">#&gt; ENSMUSG00000051951          6          4          2          0</span></a>
<a class="sourceLine" id="cb5-14" title="14"><span class="co">#&gt; ENSMUSG00000102851          0          0          0          0</span></a>
<a class="sourceLine" id="cb5-15" title="15"><span class="co">#&gt; ENSMUSG00000103377          0          0          2          0</span></a>
<a class="sourceLine" id="cb5-16" title="16"><span class="co">#&gt; ENSMUSG00000104017          0          0          0          2</span></a></code></pre></div>
<p>Note that when reading from a file R typically returns a data frame. To convert to a matrix we use the function <em>cast_matrix_to_numeric()</em>. This also converts values to numeric (in case they were read as characters). Any values that are not coercible to numeric are replaced by 0.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1">expression.matrix &lt;-<span class="st"> </span>noisyr<span class="op">::</span><span class="kw">cast_matrix_to_numeric</span>(df)</a></code></pre></div>
</div>
<div id="running-noisyr" class="section level1">
<h1><span class="header-section-number">3</span> Running <em>noisyR</em></h1>
<p>The full <em>noisyR</em> pipeline can be run through <em>noisyr()</em>, choosing “counts” for the count matrix approach (internally calls <em>noisyr_counts()</em>). The user can pass many arguments to this function, which alter the behaviour of the different pipeline steps, as discussed in the breakdown below.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1">expression.matrix.denoised.standard &lt;-<span class="st"> </span>noisyr<span class="op">::</span><span class="kw">noisyr</span>(</a>
<a class="sourceLine" id="cb7-2" title="2">  <span class="dt">approach_for_similarity_calculation =</span> <span class="st">&quot;counts&quot;</span>, </a>
<a class="sourceLine" id="cb7-3" title="3">  <span class="dt">expression.matrix =</span> df</a>
<a class="sourceLine" id="cb7-4" title="4">)</a>
<a class="sourceLine" id="cb7-5" title="5"><span class="co">#&gt; &gt;&gt;&gt; noisyR counts approach pipeline &lt;&lt;&lt;</span></a>
<a class="sourceLine" id="cb7-6" title="6"><span class="co">#&gt; The input matrix has 55573 rows and 4 cols</span></a>
<a class="sourceLine" id="cb7-7" title="7"><span class="co">#&gt;     number of genes: 55573</span></a>
<a class="sourceLine" id="cb7-8" title="8"><span class="co">#&gt;     number of samples: 4</span></a>
<a class="sourceLine" id="cb7-9" title="9"><span class="co">#&gt; Calculating the number of elements per window</span></a>
<a class="sourceLine" id="cb7-10" title="10"><span class="co">#&gt;     the number of elements per window is 5557</span></a>
<a class="sourceLine" id="cb7-11" title="11"><span class="co">#&gt;     the step size is 277</span></a>
<a class="sourceLine" id="cb7-12" title="12"><span class="co">#&gt;     the selected similarity metric is correlation_pearson</span></a>
<a class="sourceLine" id="cb7-13" title="13"><span class="co">#&gt;   Working with sample 1</span></a>
<a class="sourceLine" id="cb7-14" title="14"><span class="co">#&gt;   Working with sample 2</span></a>
<a class="sourceLine" id="cb7-15" title="15"><span class="co">#&gt;   Working with sample 3</span></a>
<a class="sourceLine" id="cb7-16" title="16"><span class="co">#&gt;   Working with sample 4</span></a>
<a class="sourceLine" id="cb7-17" title="17"><span class="co">#&gt; Calculating noise thresholds for 4 samples...</span></a>
<a class="sourceLine" id="cb7-18" title="18"><span class="co">#&gt;     similarity.threshold = 0.25</span></a>
<a class="sourceLine" id="cb7-19" title="19"><span class="co">#&gt;     method.chosen = Boxplot-IQR</span></a>
<a class="sourceLine" id="cb7-20" title="20"><span class="co">#&gt; Denoising expression matrix...</span></a>
<a class="sourceLine" id="cb7-21" title="21"><span class="co">#&gt;     removing noisy genes</span></a>
<a class="sourceLine" id="cb7-22" title="22"><span class="co">#&gt;     adjusting matrix</span></a>
<a class="sourceLine" id="cb7-23" title="23"><span class="co">#&gt; &gt;&gt;&gt; Done! &lt;&lt;&lt;</span></a></code></pre></div>
<p>The output of the noise removal is a denoised matrix that can be passed on to other methods for downstream analysis.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1"><span class="kw">head</span>(expression.matrix.denoised.standard)</a>
<a class="sourceLine" id="cb8-2" title="2"><span class="co">#&gt;                    SRR7624365 SRR7624366 SRR7624371 SRR7624372</span></a>
<a class="sourceLine" id="cb8-3" title="3"><span class="co">#&gt; ENSMUSG00000025902         94         74         32         44</span></a>
<a class="sourceLine" id="cb8-4" title="4"><span class="co">#&gt; ENSMUSG00000102269         24         48         20         26</span></a>
<a class="sourceLine" id="cb8-5" title="5"><span class="co">#&gt; ENSMUSG00000098104         76         68         62         60</span></a>
<a class="sourceLine" id="cb8-6" title="6"><span class="co">#&gt; ENSMUSG00000103922        326        273        318        365</span></a>
<a class="sourceLine" id="cb8-7" title="7"><span class="co">#&gt; ENSMUSG00000033845      14451       9925      14702      14549</span></a>
<a class="sourceLine" id="cb8-8" title="8"><span class="co">#&gt; ENSMUSG00000102275        117        100        142        124</span></a>
<a class="sourceLine" id="cb8-9" title="9"><span class="kw">apply</span>(expression.matrix.denoised.standard, <span class="dv">2</span>, min)</a>
<a class="sourceLine" id="cb8-10" title="10"><span class="co">#&gt; SRR7624365 SRR7624366 SRR7624371 SRR7624372 </span></a>
<a class="sourceLine" id="cb8-11" title="11"><span class="co">#&gt;         18         18         18         18</span></a></code></pre></div>
</div>
<div id="pipeline-breakdown" class="section level1">
<h1><span class="header-section-number">4</span> Pipeline breakdown</h1>
<p>While for most applications, running <em>noisyr()</em> is sufficient, it may be useful to run individual pipeline steps manually. For example, the user may want to create summary figures for the denoising, store the noise thresholds obtained or other intermediary outputs, or try out different options without rerunning all steps. In this section, we look deeper into <em>noisyr()</em> and break down the three main steps that are performed.</p>
<div id="similarity-calculation" class="section level2">
<h2><span class="header-section-number">4.1</span> Similarity calculation</h2>
<p>We can then run the similarity calculation using <em>calculate_expression_similarity_counts()</em>:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1">expression.summary &lt;-<span class="st"> </span>noisyr<span class="op">::</span><span class="kw">calculate_expression_similarity_counts</span>(</a>
<a class="sourceLine" id="cb9-2" title="2">  <span class="dt">expression.matrix =</span> expression.matrix, </a>
<a class="sourceLine" id="cb9-3" title="3">  <span class="dt">similarity.measure =</span> <span class="st">&quot;correlation_pearson&quot;</span></a>
<a class="sourceLine" id="cb9-4" title="4">)</a>
<a class="sourceLine" id="cb9-5" title="5"><span class="co">#&gt; The input matrix has 55573 rows and 4 cols</span></a>
<a class="sourceLine" id="cb9-6" title="6"><span class="co">#&gt;     number of genes: 55573</span></a>
<a class="sourceLine" id="cb9-7" title="7"><span class="co">#&gt;     number of samples: 4</span></a>
<a class="sourceLine" id="cb9-8" title="8"><span class="co">#&gt; Calculating the number of elements per window</span></a>
<a class="sourceLine" id="cb9-9" title="9"><span class="co">#&gt;     the number of elements per window is 5557</span></a>
<a class="sourceLine" id="cb9-10" title="10"><span class="co">#&gt;     the step size is 277</span></a>
<a class="sourceLine" id="cb9-11" title="11"><span class="co">#&gt;     the selected similarity metric is correlation_pearson</span></a>
<a class="sourceLine" id="cb9-12" title="12"><span class="co">#&gt;   Working with sample 1</span></a>
<a class="sourceLine" id="cb9-13" title="13"><span class="co">#&gt;   Working with sample 2</span></a>
<a class="sourceLine" id="cb9-14" title="14"><span class="co">#&gt;   Working with sample 3</span></a>
<a class="sourceLine" id="cb9-15" title="15"><span class="co">#&gt;   Working with sample 4</span></a>
<a class="sourceLine" id="cb9-16" title="16"><span class="kw">str</span>(expression.summary)</a>
<a class="sourceLine" id="cb9-17" title="17"><span class="co">#&gt; List of 3</span></a>
<a class="sourceLine" id="cb9-18" title="18"><span class="co">#&gt;  $ expression.matrix           : num [1:55573, 1:4] 2 0 6 0 0 0 0 0 0 0 ...</span></a>
<a class="sourceLine" id="cb9-19" title="19"><span class="co">#&gt;   ..- attr(*, &quot;dimnames&quot;)=List of 2</span></a>
<a class="sourceLine" id="cb9-20" title="20"><span class="co">#&gt;   .. ..$ : chr [1:55573] &quot;ENSMUSG00000102693&quot; &quot;ENSMUSG00000064842&quot; &quot;ENSMUSG00000051951&quot; &quot;ENSMUSG00000102851&quot; ...</span></a>
<a class="sourceLine" id="cb9-21" title="21"><span class="co">#&gt;   .. ..$ : chr [1:4] &quot;SRR7624365&quot; &quot;SRR7624366&quot; &quot;SRR7624371&quot; &quot;SRR7624372&quot;</span></a>
<a class="sourceLine" id="cb9-22" title="22"><span class="co">#&gt;  $ expression.levels           : num [1:181, 1:4] 0 0 0 0 0 0 0 0 0 0 ...</span></a>
<a class="sourceLine" id="cb9-23" title="23"><span class="co">#&gt;  $ expression.levels.similarity: num [1:181, 1:4] NA NA NA NA NA NA NA NA NA NA ...</span></a></code></pre></div>
<p>Users can select a similarity measure to assess the localised consistency in expression across samples (dissimilarity measures are inverted). See the <em>philentropy</em> package documentation for more information on the different distances. The full list of available metrics can be viewed by:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1">noisyr<span class="op">::</span><span class="kw">get_methods_correlation_distance</span>()</a>
<a class="sourceLine" id="cb10-2" title="2"><span class="co">#&gt;  [1] &quot;correlation_pearson&quot;        &quot;correlation_kendall&quot;       </span></a>
<a class="sourceLine" id="cb10-3" title="3"><span class="co">#&gt;  [3] &quot;correlation_spearman&quot;       &quot;distance_euclidean&quot;        </span></a>
<a class="sourceLine" id="cb10-4" title="4"><span class="co">#&gt;  [5] &quot;distance_manhattan&quot;         &quot;distance_minkowski&quot;        </span></a>
<a class="sourceLine" id="cb10-5" title="5"><span class="co">#&gt;  [7] &quot;distance_chebyshev&quot;         &quot;distance_sorensen&quot;         </span></a>
<a class="sourceLine" id="cb10-6" title="6"><span class="co">#&gt;  [9] &quot;distance_gower&quot;             &quot;distance_soergel&quot;          </span></a>
<a class="sourceLine" id="cb10-7" title="7"><span class="co">#&gt; [11] &quot;distance_kulczynski_d&quot;      &quot;distance_canberra&quot;         </span></a>
<a class="sourceLine" id="cb10-8" title="8"><span class="co">#&gt; [13] &quot;distance_lorentzian&quot;        &quot;distance_intersection&quot;     </span></a>
<a class="sourceLine" id="cb10-9" title="9"><span class="co">#&gt; [15] &quot;distance_non-intersection&quot;  &quot;distance_wavehedges&quot;       </span></a>
<a class="sourceLine" id="cb10-10" title="10"><span class="co">#&gt; [17] &quot;distance_czekanowski&quot;       &quot;distance_motyka&quot;           </span></a>
<a class="sourceLine" id="cb10-11" title="11"><span class="co">#&gt; [19] &quot;distance_kulczynski_s&quot;      &quot;distance_tanimoto&quot;         </span></a>
<a class="sourceLine" id="cb10-12" title="12"><span class="co">#&gt; [21] &quot;distance_ruzicka&quot;           &quot;distance_inner_product&quot;    </span></a>
<a class="sourceLine" id="cb10-13" title="13"><span class="co">#&gt; [23] &quot;distance_harmonic_mean&quot;     &quot;distance_cosine&quot;           </span></a>
<a class="sourceLine" id="cb10-14" title="14"><span class="co">#&gt; [25] &quot;distance_hassebrook&quot;        &quot;distance_jaccard&quot;          </span></a>
<a class="sourceLine" id="cb10-15" title="15"><span class="co">#&gt; [27] &quot;distance_dice&quot;              &quot;distance_fidelity&quot;         </span></a>
<a class="sourceLine" id="cb10-16" title="16"><span class="co">#&gt; [29] &quot;distance_bhattacharyya&quot;     &quot;distance_hellinger&quot;        </span></a>
<a class="sourceLine" id="cb10-17" title="17"><span class="co">#&gt; [31] &quot;distance_matusita&quot;          &quot;distance_squared_chord&quot;    </span></a>
<a class="sourceLine" id="cb10-18" title="18"><span class="co">#&gt; [33] &quot;distance_squared_euclidean&quot; &quot;distance_pearson&quot;          </span></a>
<a class="sourceLine" id="cb10-19" title="19"><span class="co">#&gt; [35] &quot;distance_neyman&quot;            &quot;distance_squared_chi&quot;      </span></a>
<a class="sourceLine" id="cb10-20" title="20"><span class="co">#&gt; [37] &quot;distance_prob_symm&quot;         &quot;distance_divergence&quot;       </span></a>
<a class="sourceLine" id="cb10-21" title="21"><span class="co">#&gt; [39] &quot;distance_clark&quot;             &quot;distance_additive_symm&quot;    </span></a>
<a class="sourceLine" id="cb10-22" title="22"><span class="co">#&gt; [41] &quot;distance_kullback-leibler&quot;  &quot;distance_jeffreys&quot;         </span></a>
<a class="sourceLine" id="cb10-23" title="23"><span class="co">#&gt; [43] &quot;distance_k_divergence&quot;      &quot;distance_topsoe&quot;           </span></a>
<a class="sourceLine" id="cb10-24" title="24"><span class="co">#&gt; [45] &quot;distance_jensen-shannon&quot;    &quot;distance_jensen_difference&quot;</span></a>
<a class="sourceLine" id="cb10-25" title="25"><span class="co">#&gt; [47] &quot;distance_taneja&quot;            &quot;distance_kumar-johnson&quot;    </span></a>
<a class="sourceLine" id="cb10-26" title="26"><span class="co">#&gt; [49] &quot;distance_avg&quot;</span></a></code></pre></div>
<p>By default, the window length is 10% of the number of rows in the matrix, as it has proven effective empirically. A different window can be specified by the <em>n.elements.per.window</em> parameter. The optimal window length can also be estimated by seeking stability of output (but this can be computationally intensive for large datasets):</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1">noisyr<span class="op">::</span><span class="kw">optimise_window_length</span>(</a>
<a class="sourceLine" id="cb11-2" title="2">  <span class="dt">expression.matrix =</span> expression.matrix,</a>
<a class="sourceLine" id="cb11-3" title="3">  <span class="dt">similarity.measure =</span> <span class="st">&quot;correlation_pearson&quot;</span></a>
<a class="sourceLine" id="cb11-4" title="4">)</a>
<a class="sourceLine" id="cb11-5" title="5"><span class="co">#&gt; Window length optimisation</span></a>
<a class="sourceLine" id="cb11-6" title="6"><span class="co">#&gt;     number of windows: 33</span></a>
<a class="sourceLine" id="cb11-7" title="7"><span class="co">#&gt;     minimum window: 555</span></a>
<a class="sourceLine" id="cb11-8" title="8"><span class="co">#&gt;     maximum window: 18339</span></a>
<a class="sourceLine" id="cb11-9" title="9"><span class="co">#&gt;     window step: 555</span></a>
<a class="sourceLine" id="cb11-10" title="10"><span class="co">#&gt;     # of iterations: 50</span></a>
<a class="sourceLine" id="cb11-11" title="11"><span class="co">#&gt;     minimum similar windows: 3</span></a>
<a class="sourceLine" id="cb11-12" title="12"><span class="co">#&gt; Calculating expression summary and JSE for each window...</span></a>
<a class="sourceLine" id="cb11-13" title="13"><span class="co">#&gt; Performing t-tests...</span></a>
<a class="sourceLine" id="cb11-14" title="14"><span class="co">#&gt; The number of similar windows found for each window (including itself) were:</span></a>
<a class="sourceLine" id="cb11-15" title="15"><span class="co">#&gt;     1 1 1 1 1 2 2 2 2 2 2 3 3 4 2 2 4 3 5 4 5 6 3 5 3 4 3 2 3 3 5 2 2</span></a>
<a class="sourceLine" id="cb11-16" title="16"><span class="co">#&gt; Optimal window found!</span></a></code></pre></div>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAeAAAAEgCAMAAABb4lATAAAA21BMVEUAAAAAADoAAGYAOpAAZmYAZrYzMzM6AAA6ADo6AGY6Ojo6OpA6kNtNTU1NTW5NTY5Nbm5NbqtNjshmAABmADpmAGZmZmZmtttmtv9uTU1uTW5uTY5ubqtujshuq+SOTU2OTW6OTY6OyP+QOgCQOjqQZgCQkGaQtpCQ27aQ2/+rbk2rbm6rbo6rq26ryKur5OSr5P+2ZgC225C22/+2///Ijk3I///bkDrb/7bb/9vb///kq27k5Kvk///r6+v/tmb/yI7/25D/27b/5Kv//7b//8j//9v//+T////UpuY3AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAPM0lEQVR4nO2dC3fbuBGFlaR2kq2VNE7aOrvbeNdus82jbdzGcbtuIrt+3f//i0qQkoghOSAo0SI4unOOLULgFSh8xGAAQdAENNM2GfoCaPdrBGzcCNi4EbBxI2DjRsDGbXXA35TjyAQlG5CAgG1LQMC2JSBg2xIQsG0JgoCvXk+nR/nR+XQ6ff6lkj2Kd7jlEoQA3/z0CVfff3KHp0cN+aN4h1suQQjwxT7maO8+fGrIH8U73HIJ2vpg14qz/4fThbN2L0Abg0UBvnv/xj04R11vxbvd76dR3PWWJAgDvjl8UyZq/TABpy9BSxTtMyXgEUoQAlzyvXjxFXcfq8MkD/DubnfayVaKJQlCgN3gN4utrn744g6f1QLpkunuriCc0jvccgnWmcki4PQlIGDbEvQDmH1wqhL0BDjdd7jlEhCwbQkI2LYEBGxbAgK2LQEB25aAgG1LQMC2JSBg2xIQsG0JCNi2BKsAXiz62R1yxRGtzVYHvDC24PQlIGDbEhCwbQlWBLy7tNXLpmQDEqwKuHqQ7DvccgkI2LYEBGxbAgK2LQEB25aAgG1LQMC2JSBg2xJwosO2BARsWwK6aNsSRG6jdHM4ffHVyyHgkUgQt43S3fsjnO97WQQ8EgnitlG6+fkL3PfAl0bAI5Egbhulqx+/zo/yF/j2rQQ89MIUmmZRgOfbKLk9OkrAYAsejQRx2yjJFgwCHo0EcdsosQ8eqwRx2yg5T80oeowSRG6jVBsHcyZrHBJwVaVtCQjYtgQEbFsCArYtAQHbloCAbUtAwLYlIGDbEhCwbQkI2LYEBGxbgr4A+8dJvcMtl4CAbUtAwLYl6GsbJa7NSs5WB7wwtuD0JSBg2xIQsG0JCNi2BARsWwICti0BAduWYB3A/gsRcJoSELBtCQjYtgQEbFsCArYtwb0AjqOdbKVYkqAPwLVvohFwMhL0AhiVAwJORgICti1BC+DF1/rdV4Wff6lkEnD6EoQBXyyonh415BJw+hIEAZ8++3vRgu8+fGrIJuD0JYhz0TeH08Wmhu4FKlbbNIsLtFKwLoDdhob1VswWnL4EkUGWs1o/TMDpS0DAtiWIA+y2Mrz7yGHS+CSIAOz+snHws1ogTcDpS+ABvn55AMwefp7/a7clYM5FJysBAduWoBfAqBwQcDISELBtCQjYtgQEbFsCArYtgQA8WRgBW5GAKzpsS0DAtiUQgM8evMsd9R6ijIDTl8AHPMv43h7vZIzjCBNw+hJ4gG+PM66Xj7NQ+uzRr4iwOMAq7WQrxZIEtWFS1orbhknVtSHhJTtcvzOQNQPOG2+v42C24CElEC76IO+CgRO6aCsS+EFW1nrzLng2OUCMEXD6Eohh0okbId0eu244xgg4fQnuf6KDgIeUoG/Au/HLO5KtFEsSNH7YsIMoWwL2mJY4CTgFCZpacD7jEWH+C9VxtvrrZCvFkgSNLnrWbZjkjIDTlKAZcLeJDmcEnKYEBGxbguY+OC7KIuD0JWgAPJvEdcEEPAIJ+t4ni4DTkoCAbUswHOByrqt2UeOrx2QliPwC+M3h9MXXamYj4PBUpcd/VxBOqVIsSRC3jdLd+yOc71dzCTh9CeK2Ubr5+YvYzaH+Qp1dNAFvRILIXXZ+/IqbnxZf8W9aALRcjrWUtizQygHfy1okWmFdALs9OkrATXcKW3CaEqzSgpteiFF0mhJE7nTXfx+ccKVYkiAO8N37N7FRdOAZEPDGJYjcRil+HBx4BgS8cQnudSYrPChOtlIsSXC/gAPZgcVaQ1eKJQkI2LYEBGxbgr4AL44JOC0JCNi2BARsW4LeAcd/zYGANyBB34Bzi5v1IOANSEDAtiXYHOAVd5UeRz0mK8EGAeu51cT46jFZCQjYtgSrAG5dLLJcrVMaN1vauK0OuOlOaW7BjWMmtuANSkAXbVsCArYtQZKAVdrJ1mOyEhCwbQkI2LYEBGxbAgK2LUGS42AC7k2CewUsEqsC9hPJ1mOyEmwQcOQXh0OJZOsxWQkI2LYEdNG2JRgI8IrNOdl6TFaCoQCrucFEsvWYrAQEbFuCIODyS6Pn0+l8w52Ysgk4GQlCgL3Nk06PGvI3DzjuQ8VxVH0CgMuNG+4+VPfnCJbdDXD01lqx813jqPoEAJdbr2S+ejpdNuJuS4NqGyztVhLejHVFUktwGVcHawdcbp509f2nhlYcd3M1TnSIFlw/tUkfzBi6oSQrQVwLzq3WD3cDLBIEnALgyuZJGwEc7pAJuHMiHEUvNk9yzvruY/QwKQKw9h3EcHMm4M6JiHGwa8TZOPhZLZBOCLDYNm+FPRLHQat3wC3Wl4vWaceOn/xzKrtgJlv1BNxhOkQHvLvlO2IiBcBoTawMWLbmpKqegLtMaGp9MAEnB7jRX7cC1sonYCOA1a6WffBAgKOGSav1wfK0ZKveDGCVdp0aAfcuwYYB+4l6aw4CFmdVRsixgGO67YRpjRSwSOgTHWq3nT/sNvmGWvEE3MkSAhwIv7SMoat+WwGrUTQBmwAsEgQ8DOCelpTo62+4yqcPWx3wErRyfE8tOBBF99qCTc2NYIsBK7RtzW5iRIC9hN4Hx5Mn4Fa7f8BRwyQ98I4rpXJhEnCcv07XqyNpwCIhAOuTX+KeiG/OCq245hw4S0dPwJWE2jYj50bCtJX3si7ggJ6AKwkVkO6i1x86rwI40gPYBywy4mi3kK8B1hx5fCm6i/VyBEY9QcCtibDvRjTgsL+O7ambV37pzXmrAcfRjgAc1QeHm3PUzVaF2pyx1VF0b4D13tk7VQJuTrQVr/fOuldXcwi4IaEGvu1xme6iVa/eci3aEoPujX7rAKvoOgL2j5t76uDQWXcN4QuLARxw5PLOWbPRY1yA12j0eh8cB1j36uptUL1B4gBX2/l6jR5WAMc1+mbagpZ3asCrd78n5sXCv4LGq1QB6/dECH36gPv06u0JnZZ/qtpt64BV2A0ZXQEH0CNyG6XyyLNkAa8Qyn1ry9BpBRttgz4kaU4Ifei1pGRuMdsoeRsqda7HZAFvxk/0AXh1P+EsZguHymYOq1cKJX1IdMB1fdwmLHI7lqEXG9GirB1wuY1SedR2c3VIULIBCVZpwcNdLiWdE+yDbUsQt41SedRj2ZRsQILIbZQsjoO3QgKTM1mU+EbAliUgYNsSrAOYNgojYONGwMaNgI0bARs3AjZuBGzcCNi4EXDY3Cdp7nejirn4q9fT6eJn/kSOmjG0hIBbLKstV2G4+hOKxWnO3AoIkaNmDC0h4DbLqsqtd8ibRfEPZWKZo2YMLekPcLI+al3J4bN/uF8UyqtMNhQvR80YWtIb4GR91LoSl5zu46L4dd38VxyXP7Xr5agZQ0v6Apysj1pXMnq7lxackI9aVzJ6WwOw6LeS9VFrS5wtlhzqHbpvV6+Pslcre3r3q3GFnzh84581fXO6KCVL7J83FonTvMijWon+tcgiha0H2AvHjdocdlGRgdGIZ+4s91OeSz/hFi3OO4K/LX+HOT8re9HirA+f8mWNRTfhF5m/0nl26n4ohBBFSlsPsBeOW7Wbw+fLRcN6t+0zyZ7If23Z6+lP95eJ03mbc8cXb7yzzheJepFZOfPgQA8hvCLFDbIOYBGO+5aQjxIlimuRRYqLKUssXuLFf4trCXXoXjFZW3LoLvZLyfnvfvhS8nPFLF6r3oJlkY5b9kr5t0vUEEIUKS9mrSDL79HE0+n4KL9EeS2iSHExXomFXb2ev8dAh+5/86O4Qfbnkry2z597rW6ecbR4vri/xP0tinzx9aL49Vc9hPCLFBfT1zApVR/ll1i/lnO//MXF+CWO3/qayUrVR/klymupteDFxfgljt/6Gial6qNkM/SvRRbpX4xfoj4YEt2+Gmi0RBoNgUYg0oiLbWSRHCaFTX+TfrevBhp6pKEGGnqkERfbyCI5TGox2e1rkYYaaAQiDS3Q0CONuNhGFjnmYVJUkV385bJI31+KN6lFGmqgEYw0mgONQKQRFdvIIkc8TIorMs5fyiLlMEm8SS3SUAONcKTRHGjokUZUbCOLHPEwKarISH/pF8lhUpNtfpgUV2S0vyyL5DBpbkMPk6KK7OAvl0WKEsWEqGrVOVCREN1+mcif8HfG8HyWP0zyB2PlsQguapFGGVxwmBS2uA+H5RxoNVF2+15C9jCV7kYOk/zB2DLQEMGFjDSEa+IwKWxyQlSDUgs0ROKiaUJUBBrVqEMMk/zBmAw0RHAhEuf3O0wSpnqvsPNq8l6681K9V8B5yWGS/wmSdyxbsOj2vYScA21I1CdE4QcaIiHr1Q8u/GMRXMhIo68WrA6TKuco3kt1XsGG0uy8dO+lOy9ZD/7QSAyT5ISo6Pa9hJgDrSS8bl8k4AUaMiHq1Q8u/IGZCGeEExXBxb0Mkyo9Chq9l+68VO+lOi/de+nOq5bwBmMcJtVMc1669wo5L8V76c5L9V6686olFkMjDpMaTXNeuvcKOi/Fe6nOS/NeAedV+TTJ+wRJTCuN3PjVFeNGwGELBBd+9Bd11gASAm41NbioRBoxZw0gIeBWU4MLGWlEnTWAhICNGwEbNwI2bgRs3AjYuBGwcbMJ+OTRr9n/s8lO9v/2eOfyyTuRPXv4WRFWz/Ttf/8KZidqNgHnBG+P/+A4X7/ca8xutABBl0XAidjl44OM7Ku/vsp4zB7UoBDw2O32OGu1s0f/cQ9nj37NuFw++eXxZOKwv5w8eJsBvj2eZB68ONE9f+LceU7Q5WQnCMUvT/+ZJfYun7yd5M+Nx2wCdlRxsoezjFr24AA/zp45e/jZOezrlw8/Zz2z652LE7/by45zbNmZ7tn8rqgo8hY8f27ot9fBjAKeOYQHuHya8TkoAB/k+HLvnCHKH7N/2Rm3f36b4XyaU1uckamqigLwQTgQS8+MAr5+9c4hc5yefs4BOyrZP9diHfdZ/uja68Hlb//9+8/588UZk9z2qoplH0zAKdjJnnPP84cA4Kzvne3cHv/xuAi1F2cAIOCk7WznZG/54AFeuOY8tnaJ2aO/HODsN68KaO6MB8tDoSDgpOzyuxxD8eABvn65I4KsLJEBnU3KZnt7nB1nlEtFEWTNO3MCTsOuX+bIclo+4MowCcWs13IyZDFMeuC11oXiZLJDwFZtNm/h4zMCbjPXJ+fOfJxGwK3mxk2j5UvA1o2AjRsBGzcCNm4EbNwI2LgRsHH7P+NA3WYySxsBAAAAAElFTkSuQmCC" /><!-- --></p>
<pre><code>#&gt; [1] 6660</code></pre>
<p>Window length optimisation can be turned on using the <em>optimise.window.length.logical</em> parameter in <em>noisyr()</em> or <em>noisyr_counts()</em>.</p>
<p>Plots of the abundance-correlation relation can be generated through the <em>plot_expression_similarity()</em> function:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" title="1">plotlist &lt;-<span class="st"> </span>noisyr<span class="op">::</span><span class="kw">plot_expression_similarity</span>(</a>
<a class="sourceLine" id="cb13-2" title="2">  <span class="dt">expression.summary =</span> expression.summary)</a>
<a class="sourceLine" id="cb13-3" title="3">plotlist[[<span class="dv">1</span>]]</a></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<blockquote>
<p>As expected, we observe low correlation values for low abundances and a steady increase towards 1 as the abundance increases. This is based on the expectation that most genes are not differentially expressed and have consistent expression, but at low abundances the stochastic nature of transcription and sequencing gives rise to noise. The local maximum at very low abundances is due to strings of zeros driving the correlation higher than expected.</p>
</blockquote>
<p>These are ggplot objects, and can thus be modified and combined intuitively. For example, plotting all the line plots together:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" title="1">plotdf.line &lt;-<span class="st"> </span>tibble<span class="op">::</span><span class="kw">tibble</span>()</a>
<a class="sourceLine" id="cb14-2" title="2"><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>){</a>
<a class="sourceLine" id="cb14-3" title="3">  lineid &lt;-<span class="st"> </span>i <span class="op">*</span><span class="st"> </span><span class="dv">2</span> <span class="op">-</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb14-4" title="4">  plotdf.line &lt;-<span class="st"> </span><span class="kw">rbind</span>(</a>
<a class="sourceLine" id="cb14-5" title="5">    plotdf.line, </a>
<a class="sourceLine" id="cb14-6" title="6">    dplyr<span class="op">::</span><span class="kw">mutate</span>(plotlist[[lineid]]<span class="op">$</span>data,</a>
<a class="sourceLine" id="cb14-7" title="7">                  <span class="dt">Sample=</span><span class="kw">colnames</span>(expression.matrix)[i]))</a>
<a class="sourceLine" id="cb14-8" title="8">}</a>
<a class="sourceLine" id="cb14-9" title="9"></a>
<a class="sourceLine" id="cb14-10" title="10">ggplot2<span class="op">::</span><span class="kw">ggplot</span>(plotdf.line) <span class="op">+</span></a>
<a class="sourceLine" id="cb14-11" title="11"><span class="st">    </span>ggplot2<span class="op">::</span><span class="kw">theme_minimal</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb14-12" title="12"><span class="st">    </span>ggplot2<span class="op">::</span><span class="kw">geom_line</span>(ggplot2<span class="op">::</span><span class="kw">aes</span>(<span class="dt">x=</span>x, <span class="dt">y=</span>y, <span class="dt">colour=</span>Sample)) <span class="op">+</span></a>
<a class="sourceLine" id="cb14-13" title="13"><span class="st">    </span>ggplot2<span class="op">::</span><span class="kw">geom_smooth</span>(ggplot2<span class="op">::</span><span class="kw">aes</span>(x,y,<span class="dt">colour=</span>Sample), <span class="dt">method=</span><span class="st">&quot;loess&quot;</span>,</a>
<a class="sourceLine" id="cb14-14" title="14">                         <span class="dt">formula=</span> y <span class="op">~</span><span class="st"> </span>x, <span class="dt">span=</span><span class="fl">0.1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb14-15" title="15"><span class="st">    </span>ggplot2<span class="op">::</span><span class="kw">ylim</span>(<span class="dv">0</span><span class="op">:</span><span class="dv">1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb14-16" title="16"><span class="st">    </span>ggplot2<span class="op">::</span><span class="kw">xlab</span>(<span class="st">&quot;log2(expression)&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb14-17" title="17"><span class="st">    </span>ggplot2<span class="op">::</span><span class="kw">ylab</span>(<span class="st">&quot;Pearson correlation&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb14-18" title="18"><span class="st">    </span>ggplot2<span class="op">::</span><span class="kw">geom_hline</span>(<span class="dt">yintercept=</span><span class="fl">0.25</span>, <span class="dt">color=</span><span class="st">&quot;black&quot;</span>)</a></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
</div>
<div id="noise-quantification" class="section level2">
<h2><span class="header-section-number">4.2</span> Noise quantification</h2>
<p>Using the output of the similarity calculation, we can compute the signal to noise threshold in each sample:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" title="1">noise.thresholds &lt;-<span class="st"> </span>noisyr<span class="op">::</span><span class="kw">calculate_noise_threshold_base</span>(<span class="dt">expression =</span> expression.summary)</a>
<a class="sourceLine" id="cb15-2" title="2"><span class="co">#&gt; Calculating noise thresholds for 4 samples...</span></a>
<a class="sourceLine" id="cb15-3" title="3"><span class="co">#&gt;     similarity.threshold = 0.25</span></a>
<a class="sourceLine" id="cb15-4" title="4"><span class="co">#&gt;     method.chosen = Boxplot-IQR</span></a>
<a class="sourceLine" id="cb15-5" title="5">noise.thresholds</a>
<a class="sourceLine" id="cb15-6" title="6"><span class="co">#&gt; [1] 19.69831 25.99208 12.12573 12.99604</span></a></code></pre></div>
<p>Here we used the default parameters: a similarity threshold of 0.25 and the Boxplot-IQR method. There are several methods available, which can be viewed with the <em>get_methods_calculate_noise_threshold()</em> function:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" title="1">noisyr<span class="op">::</span><span class="kw">get_methods_calculate_noise_threshold</span>()</a>
<a class="sourceLine" id="cb16-2" title="2"><span class="co">#&gt;  [1] &quot;Density_based-No_normalisation&quot;      </span></a>
<a class="sourceLine" id="cb16-3" title="3"><span class="co">#&gt;  [2] &quot;Density_based-RPM_normalisation&quot;     </span></a>
<a class="sourceLine" id="cb16-4" title="4"><span class="co">#&gt;  [3] &quot;Density_based-Quantile_normalisation&quot;</span></a>
<a class="sourceLine" id="cb16-5" title="5"><span class="co">#&gt;  [4] &quot;Line_plot-No_smoothing&quot;              </span></a>
<a class="sourceLine" id="cb16-6" title="6"><span class="co">#&gt;  [5] &quot;Line_plot-loess10_smoothing&quot;         </span></a>
<a class="sourceLine" id="cb16-7" title="7"><span class="co">#&gt;  [6] &quot;Line_plot-loess25_smoothing&quot;         </span></a>
<a class="sourceLine" id="cb16-8" title="8"><span class="co">#&gt;  [7] &quot;Line_plot-loess50_smoothing&quot;         </span></a>
<a class="sourceLine" id="cb16-9" title="9"><span class="co">#&gt;  [8] &quot;Boxplot-Median&quot;                      </span></a>
<a class="sourceLine" id="cb16-10" title="10"><span class="co">#&gt;  [9] &quot;Boxplot-IQR&quot;                         </span></a>
<a class="sourceLine" id="cb16-11" title="11"><span class="co">#&gt; [10] &quot;Boxplot-Quant5&quot;</span></a></code></pre></div>
<p>The first three methods are just calculating the minimum of the density plot for all genes (a common, fast approach). This usually provides a rough, overestimated signal to noise threshold.</p>
<p>The rest of the methods use either the (smoothed) line plot or the boxplot to find the noise threshold given a similarity (correlation/distance) threshold.</p>
<p>It is recommended that the method with the least coefficient of variation across all samples is chosen for noise removal. This can also be applied to compute the correlation/distance threshold instead of supplying it manually, which is especially useful for non-correlation measures which don’t have a standard range.</p>
<p>For example, by looking to minimise the coefficient of variation, we get a correlation threshold of 0.21 and the loess10 smoothing method for this dataset:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" title="1">similarity.threshold.sequence &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="fl">0.2</span>, <span class="fl">0.3</span>, <span class="dt">by=</span><span class="fl">0.01</span>)</a>
<a class="sourceLine" id="cb17-2" title="2">stats.table &lt;-<span class="st"> </span>noisyr<span class="op">::</span><span class="kw">calculate_noise_threshold_method_statistics</span>(</a>
<a class="sourceLine" id="cb17-3" title="3">  <span class="dt">expression =</span> expression.summary,</a>
<a class="sourceLine" id="cb17-4" title="4">  <span class="dt">similarity.threshold.sequence =</span> similarity.threshold.sequence</a>
<a class="sourceLine" id="cb17-5" title="5">)</a>
<a class="sourceLine" id="cb17-6" title="6">row.min.coef.var &lt;-<span class="st"> </span><span class="kw">which.min</span>(stats.table<span class="op">$</span>noise.threshold.coefficient.of.variation)</a>
<a class="sourceLine" id="cb17-7" title="7"><span class="co"># adjust column names for printing</span></a>
<a class="sourceLine" id="cb17-8" title="8"><span class="kw">colnames</span>(stats.table) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;approach&quot;</span>, <span class="st">&quot;method&quot;</span>, <span class="st">&quot;corr.thr&quot;</span>, <span class="st">&quot;min&quot;</span>, <span class="st">&quot;mean&quot;</span>, <span class="st">&quot;coef.var&quot;</span>, <span class="st">&quot;max&quot;</span>, <span class="st">&quot;all&quot;</span>)</a>
<a class="sourceLine" id="cb17-9" title="9">stats.table[row.min.coef.var, <span class="dv">1</span><span class="op">:</span><span class="dv">7</span>]</a>
<a class="sourceLine" id="cb17-10" title="10"><span class="co">#&gt; # A tibble: 1 x 7</span></a>
<a class="sourceLine" id="cb17-11" title="11"><span class="co">#&gt;   approach  method            corr.thr   min  mean coef.var   max</span></a>
<a class="sourceLine" id="cb17-12" title="12"><span class="co">#&gt;   &lt;chr&gt;     &lt;chr&gt;                &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb17-13" title="13"><span class="co">#&gt; 1 Line_plot loess10_smoothing     0.21  7.37  9.88    0.253  13.3</span></a>
<a class="sourceLine" id="cb17-14" title="14">dplyr<span class="op">::</span><span class="kw">filter</span>(stats.table, <span class="kw">round</span>(corr.thr, <span class="dv">2</span>) <span class="op">==</span><span class="st"> </span><span class="fl">0.21</span>)[, <span class="dv">1</span><span class="op">:</span><span class="dv">7</span>]</a>
<a class="sourceLine" id="cb17-15" title="15"><span class="co">#&gt; # A tibble: 10 x 7</span></a>
<a class="sourceLine" id="cb17-16" title="16"><span class="co">#&gt;    approach      method                 corr.thr    min   mean coef.var   max</span></a>
<a class="sourceLine" id="cb17-17" title="17"><span class="co">#&gt;    &lt;chr&gt;         &lt;chr&gt;                     &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb17-18" title="18"><span class="co">#&gt;  1 Density_based No_normalisation           0.21 308    308      NA     308  </span></a>
<a class="sourceLine" id="cb17-19" title="19"><span class="co">#&gt;  2 Density_based RPM_normalisation          0.21 290    290      NA     290  </span></a>
<a class="sourceLine" id="cb17-20" title="20"><span class="co">#&gt;  3 Density_based Quantile_normalisation     0.21 304    304      NA     304  </span></a>
<a class="sourceLine" id="cb17-21" title="21"><span class="co">#&gt;  4 Line_plot     No_smoothing               0.21   0      0     NaN       0  </span></a>
<a class="sourceLine" id="cb17-22" title="22"><span class="co">#&gt;  5 Line_plot     loess10_smoothing          0.21   7.37   9.88    0.253  13.3</span></a>
<a class="sourceLine" id="cb17-23" title="23"><span class="co">#&gt;  6 Line_plot     loess25_smoothing          0.21   4.26   9.20    0.450  14.3</span></a>
<a class="sourceLine" id="cb17-24" title="24"><span class="co">#&gt;  7 Line_plot     loess50_smoothing          0.21   6.47   9.92    0.336  14.3</span></a>
<a class="sourceLine" id="cb17-25" title="25"><span class="co">#&gt;  8 Boxplot       Median                     0.21   8.57  11.6     0.271  16  </span></a>
<a class="sourceLine" id="cb17-26" title="26"><span class="co">#&gt;  9 Boxplot       IQR                        0.21   8.57  11.6     0.271  16  </span></a>
<a class="sourceLine" id="cb17-27" title="27"><span class="co">#&gt; 10 Boxplot       Quant5                     0.21   8.57  11.6     0.271  16</span></a>
<a class="sourceLine" id="cb17-28" title="28">dplyr<span class="op">::</span><span class="kw">filter</span>(stats.table, method <span class="op">==</span><span class="st"> &quot;loess10_smoothing&quot;</span>)[, <span class="dv">1</span><span class="op">:</span><span class="dv">7</span>]</a>
<a class="sourceLine" id="cb17-29" title="29"><span class="co">#&gt; # A tibble: 11 x 7</span></a>
<a class="sourceLine" id="cb17-30" title="30"><span class="co">#&gt;    approach  method            corr.thr   min  mean coef.var   max</span></a>
<a class="sourceLine" id="cb17-31" title="31"><span class="co">#&gt;    &lt;chr&gt;     &lt;chr&gt;                &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb17-32" title="32"><span class="co">#&gt;  1 Line_plot loess10_smoothing     0.2   3.72  8.42    0.425  12.4</span></a>
<a class="sourceLine" id="cb17-33" title="33"><span class="co">#&gt;  2 Line_plot loess10_smoothing     0.21  7.37  9.88    0.253  13.3</span></a>
<a class="sourceLine" id="cb17-34" title="34"><span class="co">#&gt;  3 Line_plot loess10_smoothing     0.22  8.42 11.3     0.321  16.6</span></a>
<a class="sourceLine" id="cb17-35" title="35"><span class="co">#&gt;  4 Line_plot loess10_smoothing     0.23  9.02 12.7     0.358  19.3</span></a>
<a class="sourceLine" id="cb17-36" title="36"><span class="co">#&gt;  5 Line_plot loess10_smoothing     0.24 10.4  14.3     0.395  22.5</span></a>
<a class="sourceLine" id="cb17-37" title="37"><span class="co">#&gt;  6 Line_plot loess10_smoothing     0.25 10.6  16.1     0.388  24.3</span></a>
<a class="sourceLine" id="cb17-38" title="38"><span class="co">#&gt;  7 Line_plot loess10_smoothing     0.26 11.4  17.9     0.433  28.4</span></a>
<a class="sourceLine" id="cb17-39" title="39"><span class="co">#&gt;  8 Line_plot loess10_smoothing     0.27 11.4  19.4     0.439  30.8</span></a>
<a class="sourceLine" id="cb17-40" title="40"><span class="co">#&gt;  9 Line_plot loess10_smoothing     0.28 12.2  24.0     0.578  43.3</span></a>
<a class="sourceLine" id="cb17-41" title="41"><span class="co">#&gt; 10 Line_plot loess10_smoothing     0.29 15.9  28.0     0.505  47.4</span></a>
<a class="sourceLine" id="cb17-42" title="42"><span class="co">#&gt; 11 Line_plot loess10_smoothing     0.3  17.1  35.4     0.486  52.0</span></a></code></pre></div>
<p>We can then call <em>calculate_noise_threshold_base()</em> with our optimised parameters:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" title="1">noise.thresholds &lt;-<span class="st"> </span>noisyr<span class="op">::</span><span class="kw">calculate_noise_threshold_base</span>(</a>
<a class="sourceLine" id="cb18-2" title="2">  <span class="dt">expression =</span> expression.summary,</a>
<a class="sourceLine" id="cb18-3" title="3">  <span class="dt">similarity.threshold =</span> <span class="fl">0.21</span>,</a>
<a class="sourceLine" id="cb18-4" title="4">  <span class="dt">method.chosen =</span> <span class="st">&quot;Line_plot-loess10_smoothing&quot;</span></a>
<a class="sourceLine" id="cb18-5" title="5">)</a>
<a class="sourceLine" id="cb18-6" title="6"><span class="co">#&gt; Calculating noise thresholds for 4 samples...</span></a>
<a class="sourceLine" id="cb18-7" title="7"><span class="co">#&gt;     similarity.threshold = 0.21</span></a>
<a class="sourceLine" id="cb18-8" title="8"><span class="co">#&gt;     method.chosen = Line_plot-loess10_smoothing</span></a>
<a class="sourceLine" id="cb18-9" title="9">noise.thresholds</a>
<a class="sourceLine" id="cb18-10" title="10"><span class="co">#&gt; [1]  9.664027 13.325175  7.368364  9.171495</span></a></code></pre></div>
<p>Noise removal parameter optimisation can be turned on using the <em>minimise.coefficient.of.variation</em> parameter in <em>noisyr()</em> or <em>noisyr_counts()</em> and passing further parameters for <em>similarity.threshold.sequence</em> and/or <em>method.chosen.sequence</em>.</p>
</div>
<div id="noise-removal" class="section level2">
<h2><span class="header-section-number">4.3</span> Noise removal</h2>
<p>To produce the denoised count matrix, the function <em>remove_noise_from_matrix()</em> is used with a specified vector of noise thresholds (usually calculated by <em>calculate_noise_threshold_base()</em>).</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" title="1">expression.matrix.denoised &lt;-<span class="st"> </span>noisyr<span class="op">::</span><span class="kw">remove_noise_from_matrix</span>(</a>
<a class="sourceLine" id="cb19-2" title="2">  <span class="dt">expression.matrix =</span> expression.matrix,</a>
<a class="sourceLine" id="cb19-3" title="3">  <span class="dt">noise.thresholds =</span> noise.thresholds)</a>
<a class="sourceLine" id="cb19-4" title="4"><span class="co">#&gt; Denoising expression matrix...</span></a>
<a class="sourceLine" id="cb19-5" title="5"><span class="co">#&gt;     removing noisy genes</span></a>
<a class="sourceLine" id="cb19-6" title="6"><span class="co">#&gt;     adjusting matrix</span></a>
<a class="sourceLine" id="cb19-7" title="7"><span class="kw">str</span>(expression.matrix.denoised)</a>
<a class="sourceLine" id="cb19-8" title="8"><span class="co">#&gt;  num [1:24341, 1:4] 17 86 16 68 318 ...</span></a>
<a class="sourceLine" id="cb19-9" title="9"><span class="co">#&gt;  - attr(*, &quot;dimnames&quot;)=List of 2</span></a>
<a class="sourceLine" id="cb19-10" title="10"><span class="co">#&gt;   ..$ : chr [1:24341] &quot;ENSMUSG00000102343&quot; &quot;ENSMUSG00000025902&quot; &quot;ENSMUSG00000102269&quot; &quot;ENSMUSG00000098104&quot; ...</span></a>
<a class="sourceLine" id="cb19-11" title="11"><span class="co">#&gt;   ..$ : chr [1:4] &quot;SRR7624365&quot; &quot;SRR7624366&quot; &quot;SRR7624371&quot; &quot;SRR7624372&quot;</span></a></code></pre></div>
<p>The behaviour of <em>remove_noise_from_matrix()</em> can be further modified:</p>
<ul>
<li><strong><em>add.threshold</em></strong> whether to add the noise threshold to each entry (default) or set each entry under the noise threshold to the noise threshold.</li>
<li><strong><em>average.threshold</em></strong> whether the noise thresholds for the different samples are averaged (default) or used individually. The latter should be especially avoided if the thresholds have high variance, as it could intoduce artificial differences in the data.<br />
</li>
<li><strong><em>remove.noisy.features</em></strong> whether genes/features whose expression is under the noise threshold in every sample should be removed from the matrix (default) or not</li>
</ul>
<p>Because of these defaults, passing the mean of the thresholds gives a slightly different result (different # of genes fully under the noise threshold:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" title="1">expression.matrix.denoised.fixed &lt;-<span class="st"> </span>noisyr<span class="op">::</span><span class="kw">remove_noise_from_matrix</span>(</a>
<a class="sourceLine" id="cb20-2" title="2">  <span class="dt">expression.matrix =</span> expression.matrix, </a>
<a class="sourceLine" id="cb20-3" title="3">  <span class="dt">noise.thresholds =</span> <span class="kw">mean</span>(noise.thresholds))</a>
<a class="sourceLine" id="cb20-4" title="4"><span class="co">#&gt; noise.thresholds only has 1 value, using a fixed threshold...</span></a>
<a class="sourceLine" id="cb20-5" title="5"><span class="co">#&gt; Denoising expression matrix...</span></a>
<a class="sourceLine" id="cb20-6" title="6"><span class="co">#&gt;     removing noisy genes</span></a>
<a class="sourceLine" id="cb20-7" title="7"><span class="co">#&gt;     adjusting matrix</span></a>
<a class="sourceLine" id="cb20-8" title="8"><span class="kw">nrow</span>(expression.matrix.denoised); <span class="kw">nrow</span>(expression.matrix.denoised.fixed)</a>
<a class="sourceLine" id="cb20-9" title="9"><span class="co">#&gt; [1] 24341</span></a>
<a class="sourceLine" id="cb20-10" title="10"><span class="co">#&gt; [1] 24309</span></a></code></pre></div>
<p>By supplying the corresponding parameters to <em>noisyr()</em>, we obtain the same final result from the full pipeline:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" title="1">expression.matrix.denoised.full_pipeline &lt;-<span class="st"> </span>noisyr<span class="op">::</span><span class="kw">noisyr</span>(</a>
<a class="sourceLine" id="cb21-2" title="2">  <span class="dt">approach_for_similarity_calculation =</span> <span class="st">&quot;counts&quot;</span>, </a>
<a class="sourceLine" id="cb21-3" title="3">  <span class="dt">expression.matrix =</span> expression.matrix,</a>
<a class="sourceLine" id="cb21-4" title="4">  <span class="dt">similarity.measure =</span> <span class="st">&quot;correlation_pearson&quot;</span>,</a>
<a class="sourceLine" id="cb21-5" title="5">  <span class="dt">optimise.window.length.logical =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb21-6" title="6">  <span class="dt">minimise.coefficient.of.variation =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb21-7" title="7">  <span class="dt">similarity.threshold.sequence =</span> <span class="kw">seq</span>(<span class="fl">0.2</span>, <span class="fl">0.3</span>, <span class="dt">by=</span><span class="fl">0.01</span>)</a>
<a class="sourceLine" id="cb21-8" title="8">)</a>
<a class="sourceLine" id="cb21-9" title="9"><span class="co">#&gt; &gt;&gt;&gt; noisyR counts approach pipeline &lt;&lt;&lt;</span></a>
<a class="sourceLine" id="cb21-10" title="10"><span class="co">#&gt; The input matrix has 55573 rows and 4 cols</span></a>
<a class="sourceLine" id="cb21-11" title="11"><span class="co">#&gt;     number of genes: 55573</span></a>
<a class="sourceLine" id="cb21-12" title="12"><span class="co">#&gt;     number of samples: 4</span></a>
<a class="sourceLine" id="cb21-13" title="13"><span class="co">#&gt; Calculating the number of elements per window</span></a>
<a class="sourceLine" id="cb21-14" title="14"><span class="co">#&gt;     the number of elements per window is 5557</span></a>
<a class="sourceLine" id="cb21-15" title="15"><span class="co">#&gt;     the step size is 277</span></a>
<a class="sourceLine" id="cb21-16" title="16"><span class="co">#&gt;     the selected similarity metric is correlation_pearson</span></a>
<a class="sourceLine" id="cb21-17" title="17"><span class="co">#&gt;   Working with sample 1</span></a>
<a class="sourceLine" id="cb21-18" title="18"><span class="co">#&gt;   Working with sample 2</span></a>
<a class="sourceLine" id="cb21-19" title="19"><span class="co">#&gt;   Working with sample 3</span></a>
<a class="sourceLine" id="cb21-20" title="20"><span class="co">#&gt;   Working with sample 4</span></a>
<a class="sourceLine" id="cb21-21" title="21"><span class="co">#&gt; Selecting parameters that minimise the coefficient of variation...</span></a>
<a class="sourceLine" id="cb21-22" title="22"><span class="co">#&gt; Calculating noise thresholds for 4 samples...</span></a>
<a class="sourceLine" id="cb21-23" title="23"><span class="co">#&gt;     similarity.threshold = 0.21</span></a>
<a class="sourceLine" id="cb21-24" title="24"><span class="co">#&gt;     method.chosen = Line_plot-loess10_smoothing</span></a>
<a class="sourceLine" id="cb21-25" title="25"><span class="co">#&gt; Denoising expression matrix...</span></a>
<a class="sourceLine" id="cb21-26" title="26"><span class="co">#&gt;     removing noisy genes</span></a>
<a class="sourceLine" id="cb21-27" title="27"><span class="co">#&gt;     adjusting matrix</span></a>
<a class="sourceLine" id="cb21-28" title="28"><span class="co">#&gt; &gt;&gt;&gt; Done! &lt;&lt;&lt;</span></a>
<a class="sourceLine" id="cb21-29" title="29"><span class="kw">identical</span>(expression.matrix.denoised,</a>
<a class="sourceLine" id="cb21-30" title="30">          expression.matrix.denoised.full_pipeline)</a>
<a class="sourceLine" id="cb21-31" title="31"><span class="co">#&gt; [1] TRUE</span></a></code></pre></div>
</div>
</div>
<div id="downstream-analysis" class="section level1">
<h1><span class="header-section-number">5</span> Downstream analysis</h1>
<p>The denoised matrix can be used instead of the raw count matrix for downstream analysis. Here we present a simple example of a differential expression (DE) analysis and compare the two.</p>
<p>We create a function to perform the same DE pipeline on both matrices, using <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC2796818/">the edgeR package</a>.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" title="1">DE_edgeR =<span class="st"> </span><span class="cf">function</span>(expression.matrix, metadata){</a>
<a class="sourceLine" id="cb22-2" title="2">  <span class="co"># load or install edgeR</span></a>
<a class="sourceLine" id="cb22-3" title="3">  <span class="cf">if</span>(<span class="op">!</span><span class="kw">require</span>(edgeR)){</a>
<a class="sourceLine" id="cb22-4" title="4">    <span class="cf">if</span> (<span class="op">!</span><span class="kw">requireNamespace</span>(<span class="st">&quot;BiocManager&quot;</span>, <span class="dt">quietly =</span> <span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb22-5" title="5">      <span class="kw">install.packages</span>(<span class="st">&quot;BiocManager&quot;</span>)</a>
<a class="sourceLine" id="cb22-6" title="6">    BiocManager<span class="op">::</span><span class="kw">install</span>(<span class="st">&quot;edgeR&quot;</span>)</a>
<a class="sourceLine" id="cb22-7" title="7">  }</a>
<a class="sourceLine" id="cb22-8" title="8">  </a>
<a class="sourceLine" id="cb22-9" title="9">  <span class="co"># create metadata</span></a>
<a class="sourceLine" id="cb22-10" title="10">  metadata &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">id =</span> <span class="kw">colnames</span>(expression.matrix),</a>
<a class="sourceLine" id="cb22-11" title="11">                         <span class="dt">timepoint =</span> <span class="kw">c</span>(<span class="st">&quot;0h&quot;</span>, <span class="st">&quot;0h&quot;</span>, <span class="st">&quot;12h&quot;</span>, <span class="st">&quot;12h&quot;</span>))</a>
<a class="sourceLine" id="cb22-12" title="12">  </a>
<a class="sourceLine" id="cb22-13" title="13">  <span class="co"># quantile normalise</span></a>
<a class="sourceLine" id="cb22-14" title="14">  expression.matrix.normalised &lt;-<span class="st"> </span>preprocessCore<span class="op">::</span><span class="kw">normalize.quantiles</span>(expression.matrix)</a>
<a class="sourceLine" id="cb22-15" title="15">  <span class="kw">rownames</span>(expression.matrix.normalised) &lt;-<span class="st"> </span>base<span class="op">::</span><span class="kw">rownames</span>(expression.matrix)</a>
<a class="sourceLine" id="cb22-16" title="16">  <span class="kw">colnames</span>(expression.matrix.normalised) &lt;-<span class="st"> </span>base<span class="op">::</span><span class="kw">colnames</span>(expression.matrix)</a>
<a class="sourceLine" id="cb22-17" title="17">  </a>
<a class="sourceLine" id="cb22-18" title="18">  <span class="co"># process using edgeR</span></a>
<a class="sourceLine" id="cb22-19" title="19">  expression.matrix.for.de &lt;-<span class="st"> </span><span class="kw">round</span>(expression.matrix.normalised)</a>
<a class="sourceLine" id="cb22-20" title="20">  expression.matrix.for.de &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb22-21" title="21"><span class="st">    </span>expression.matrix.for.de[<span class="kw">apply</span>(expression.matrix.for.de, <span class="dv">1</span>, sum) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, ]</a>
<a class="sourceLine" id="cb22-22" title="22">  design &lt;-<span class="st"> </span><span class="kw">model.matrix</span>(<span class="op">~</span><span class="st"> </span><span class="dv">0</span> <span class="op">+</span><span class="st"> </span>metadata<span class="op">$</span>timepoint)</a>
<a class="sourceLine" id="cb22-23" title="23">  edger &lt;-<span class="st"> </span><span class="kw">DGEList</span>(<span class="dt">counts =</span> expression.matrix.for.de)</a>
<a class="sourceLine" id="cb22-24" title="24">  edger &lt;-<span class="st"> </span><span class="kw">estimateDisp</span>(edger, design)</a>
<a class="sourceLine" id="cb22-25" title="25">  edger.fit &lt;-<span class="st"> </span><span class="kw">glmFit</span>(edger, design)</a>
<a class="sourceLine" id="cb22-26" title="26">  edger.lrt &lt;-<span class="st"> </span><span class="kw">glmLRT</span>(edger.fit, <span class="dt">contrast=</span><span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>))</a>
<a class="sourceLine" id="cb22-27" title="27">  </a>
<a class="sourceLine" id="cb22-28" title="28">  <span class="co"># extract results</span></a>
<a class="sourceLine" id="cb22-29" title="29">  res &lt;-<span class="st"> </span><span class="kw">topTags</span>(edger.lrt, <span class="dt">n =</span> <span class="ot">Inf</span>)<span class="op">$</span>table</a>
<a class="sourceLine" id="cb22-30" title="30">  res<span class="op">$</span>DE &lt;-<span class="st"> </span>res<span class="op">$</span>FDR <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.05</span> <span class="op">&amp;</span><span class="st"> </span><span class="kw">abs</span>(res<span class="op">$</span>logFC) <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb22-31" title="31">  </a>
<a class="sourceLine" id="cb22-32" title="32">  <span class="co"># make volcano plot</span></a>
<a class="sourceLine" id="cb22-33" title="33">  <span class="kw">print</span>(</a>
<a class="sourceLine" id="cb22-34" title="34">    ggplot2<span class="op">::</span><span class="kw">ggplot</span>(res) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb22-35" title="35"><span class="st">      </span>ggplot2<span class="op">::</span><span class="kw">theme_minimal</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb22-36" title="36"><span class="st">      </span>ggplot2<span class="op">::</span><span class="kw">geom_point</span>(ggplot2<span class="op">::</span><span class="kw">aes</span>(<span class="dt">x=</span>logFC, <span class="dt">y=</span><span class="op">-</span><span class="kw">log10</span>(FDR), <span class="dt">color=</span>DE), <span class="dt">show.legend=</span><span class="ot">FALSE</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb22-37" title="37"><span class="st">      </span>ggplot2<span class="op">::</span><span class="kw">scale_color_manual</span>(<span class="dt">values=</span><span class="kw">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;red&quot;</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb22-38" title="38"><span class="st">      </span>ggplot2<span class="op">::</span><span class="kw">lims</span>(<span class="dt">x=</span><span class="kw">c</span>(<span class="op">-</span><span class="dv">12</span>, <span class="dv">12</span>), <span class="dt">y=</span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">120</span>))</a>
<a class="sourceLine" id="cb22-39" title="39">  )</a>
<a class="sourceLine" id="cb22-40" title="40">  </a>
<a class="sourceLine" id="cb22-41" title="41">  <span class="kw">return</span>(res)</a>
<a class="sourceLine" id="cb22-42" title="42">  </a>
<a class="sourceLine" id="cb22-43" title="43">}</a>
<a class="sourceLine" id="cb22-44" title="44"></a>
<a class="sourceLine" id="cb22-45" title="45">results.raw &lt;-<span class="st"> </span><span class="kw">DE_edgeR</span>(expression.matrix)</a></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" title="1">results.denoised &lt;-<span class="st"> </span><span class="kw">DE_edgeR</span>(expression.matrix.denoised)</a></code></pre></div>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASAAAAEgCAMAAAAjXV6yAAAAq1BMVEUAAAAAADoAAGYAOpAAZrY6AAA6ADo6AGY6kNtNTU1NTW5NTY5NbqtNjshmAABmADpmAGZmtv9uTU1uTW5uTY5ubqtuq+SOTU2OTW6OTY6OyP+QOgCQkGaQtpCQ2/+rbk2rbm6rbo6ryKur5P+2ZgC2kDq2///Ijk3I///bkDrbkJDb///kq27k///r6+v/AAD/tmb/yI7/25D/5Kv//7b//8j//9v//+T////UW4w+AAAACXBIWXMAAA7DAAAOwwHHb6hkAAALY0lEQVR4nO2dAXvbJhCG1TRb467N1m5Lt2RrtzZL6q2NnNZJ9f9/2YyEEKCDOyyQkHTf87R2LqcTvAGEAImiYnlVTJ2A3MWAEDEgRAwIEQNC5AX09ZePh/9ebzaXVfVps9n88HGsZOUjH6B7QeThtw/V158/VLeXvd/fgUeB1vm6egDdPn9/KEH3L8XXy29/fZgkfZO74lXsoEMpenizqWuajLF8hQD69u6irmV2Kcrsb53GlQDo4c2F/NlqhzLLShpXylVMYWFAlgQgyef+xefq29/mZT6zrKRxRQGJ/o9ong+fz60LWWZZSeM6pCedWVbSuDIgxMiAECMDQowMCDEyIMTIgBAjA0KMDAgxMiDEyIAQIwNCjAwIMTIgxMiAECMDQozHAZp6ymEEDQMEofZa5+vKgBAjA0KMDAgxMiDEyIAQIwNCjAwIMTIgxMiAECMDQowMCDEyIMTIgBAjA0KMDAgxMiDEyIAQI77K9eHN5sVn9TF2+iZ3RZ/V+Pbusvr0sv0YPX2Tu6LPajz8/lGUJPkxevqOci3LMlpUfJ30r5/Fsxryo42RtUqhoUHIgMQK8gMZ+RHnr5LYtQYUK+pxJWjgSRO7jguI2yCPBBHxLFR9Fbvgq1hP3A/injRqZECIkQEhRgaEGBkQYmRAiJEBIcZFAWp60AzIZZT3YAzIZWRAiJEBYUZugyZwZUCIkQEhRgaEGBkQYhz5YZYI8zEjaRggCLXXKo3WfMNyS9CxJ2VAyEkZEHZSc8aKAY3o2qFnQJBRq7wMCDIuGJA9kc6ATGtvKUbObdC2qHUGBot4Ut0aC1Aq1w7Q/rwlsy2evAXjxTqpbp0NoP1PN53V+MGpnNqgZK6Tt0FSSBOSF6B/KcVnyEn7VuwilAWg66I4rURbdMKAOnWAtic3j1dn1a4oXoHBIp60b40LKMkaRQGn2j39p3j6HxgrIH3HuMZsg9Ksct2fHwrOl+/InaAhJ03smhRQj4/2wm1745E1Avoe7CGKZfZz2ngkSRvkASRW2PPGIx5AYgH5/DYeGTiBAgAqWln9oPoRjdltPEIZ/o50q3GvVtjPaV+NEQHdXqhvKwe0qyuY3Y9uKtb8Nh4hTKCEAXq8qtue/bnVlZZPieW/8UhLJNm9mART33OQlBcgVacSAXq8auvWlno3ti5AdT+o1m6C4Y4IrgwIMyZug+YPKI3r8gABd6pDohJuNZzKD1ApFTFqLrMaUVxLBuQ3JgXUtUFkZQsoZlQTELl9HnbSZK7Na02iRl0WoP5M/+CoOQHyPKzDgCr/414MqIoDqErZBk3dUYwCKLprThuPZPUgxzBAEGqvFXHVG45cS9BkK8wqq2nNFZBohGRfetQ1ikLzAFTVS6hGXeXaYpkNoEANTV/HZQ5t0BGKByhm1HSA5DJy8gq8tQG6lv3D/fkpGCziSVvFHblJ47q8MWkGNK6rVsXkhOqIVWwOrlojvRu7kZ6Fax73YlFcU6/uCFdegFLPzR+hIbl2D/0wIKEmN7MCNO6Iog2oztvAQfvkbdA2aED66JO2LFpA4ouaEs17yPWa/qDP8SeVGBSL0lTWgGDJp1hivZFcv0NdBqBmcXS0nVlAQPqs+twAyecP4u2KYA8eam3SgKg9qzVSEAVQdyHT7sbkUyyJd2apAcWJEykgBKi5ju3Pzx6vOkLyKZbUO7OY9e7YqA0W9S0kAS6jWYLq+9TdyY094nF7OYudWcoJAc1iZxYNUJI2SFUxfbG9fIol0c4swKBrXjcw1lVs14wHbfWJQ/kUS5KdWaBh+6Co1uHxb4GnG+6o/9YAIHAg3xXVPF67We1FmR2gprXoA4LKlDuq4a26nFCUSIC2ITPPMS7IvZwMBaR1zOOkFW6kaYrRY7GzEgSoHBlQd5kHo9HCB7VBAJCQNsg6WEOTpg0aFZC0AiWIHlWjoY4LAZxzFVNWWg1zt0H9BxBSXsXGa6Qd1kBA3TEmoGRXsTClAkS/imnHrARQ4GVeHWONMqUAlMU66eASBDkvoyfdt5Z2VSFEBd0Xci/Ws8YE1LdGA0R+q8CQk4JW1QcOiOoABJjnC6jLSvPtmBJkHrMsQEBPmthIl2o0oHeZnx5QhPkHqTovxg+GBTuwdi1L60BiCK9cgEIUuwTpGcUC6K6leWDaEhSi2PdiRwIy5Xg4fL6ANDW5onVunFj0uewYaZ0roMoGJG3VIgHJvAQBctbIBQJSmWnaWCIgvWrZv6h6/allAJJGgI9zZASgubx7MRsQLcCKAEGXekKAFQGyHs6ECIEBAlxnBqjsJonbn/s9YjwqWNbgRmxegNqMmYDKWIDIx88ZEBq1lF0m9UPnuiBAKiOqhrlGpcFbjTv9B/373AGZXeeqz4d4LwYAIpdAalonvYq1edFqFrUN8gKKmdYMAJUgIKxz0zkZ7ssCdKdTqazShAYwi59mjZrWiTuKHSGV4TuQEFjF4DI3dkfx6+t6v4gkO7MYWQsBBFZKSfku6bxYT2L1uFhtn2RnFggQXMecgKwOuFZl46QVBXQvFkffXqbZmcVkUbYDOXgGe1CmAyR0KEVDd2Yp4XmYJkd9i22Fj3No9Gkfscp+4M4swN9UdzVqWWAVM4pNTWbcNkissW93Hjl+4xEHoNLsUVtZdkeVDnf2ZAZ0ZHBaw69iCktsQAaYyleAzKhAtfKOlYSlNRCQ5DN0ZxYw1RYgTwFCAfmODU2r8RMKSNuhLvrOLCozAB9fFQOZlGZ1JSUg+560kRdvOaCUIO2X8dKa0UveBgMqoahD0zohIPvv7q1jCCD73ixeWjMB5KszvQCuAtQRipjW6QGV+ncKID+ftI9khilKG1QCXUQGpKyKRAneloMB1gjIUYjgAKsCBN9LAYS6ABifhQHyZxgKgPFhQNgBDIgBAYRUAK87A1ojIFodIwJa3lUMz68VwOfb/J8DoIEzBp0wPr25CfSAWJu7DAMEofZasZ40uQThgLIoQQNP2lnjA1p7G7Q2QGh+rSUbftdycbcaKl9xAIUnADdmD6g0AhD4LBAQpVzIAEWB4VkWIGvFS0/FAYgeoFgdICkfId21cBIamAC3MQ9ALkL1u1Y6VwoeBsSAwErWAoIRDU+A05g5IFWEhKuTz4oBKUIKEEQoQgKcxswBFRogB544CXAaMwekCLWAeogiJcBpzBxQ0QGi8lkkIICJqerOMuQHKMkLt9svGB9ATj4TAYq28QhoXQCgxC/9PwKQ68mwiQAl3nhEiUwoXRIahQJKvfGIacT5JE5Ap+NK0MCTUl3daEZKQJVNG5SvK/0qlmTjkfxd8+gHZeyaR086Y1cGhBgZEGJkQIiRASHGIYBWIQaEiAEhYkCIGBAiBoSIASFiQIgYEKLYgOpBNWBoBBLw1i9YxHhBMakpjQzoXqQOmiKCBLz1CxQ1XkhMckrjArp9/v7wd4GGZwFBb/0CRYwXFJOc0hRVDBrgB2S+9csXkxYvKCY5pSkAQVNEkCvw1i9QxHhBMckpjQbodrN5WZH/LtKb1mYElCByzElLUECbQcpMSDxqTHJKUwCCpogAQW/9AkWMFxSTnNKJ+0H2W79ghfWDaDEn6gctTwwIEQNCxIAQMSBEDAhRjoC+fP/WNj1eNaunXlXNnu9Peh6pNBtAZ+qb2Oh0W6MaQ7MDdN1sBBuyYe4g5QpI1KnTqt7l/cmfz24UoP35WEVHKlNAj1enlfi3Pz87/DvpAAGlK60yBbQ7uamqw3/151YAqtvos+rLs5txE5MrINHEHD7rpubLMy5BhnyA2jZo/+NIoHIFJDo6bRXbaW1Qe/nanoxU1TIF5GykuR9U9S/zf+iADj2h1fekbe3G6hRCyhyQaItEVZtOmQOq70yn5JM9oMnFgBAxIEQMCBEDQsSAEDEgRP8DAqq42ghU+UQAAAAASUVORK5CYII=" /><!-- --></p>
<blockquote>
<p>We observe the distribution of genes in the volcano plots becoming a lot tighter for the denoised matrix. For the raw matrix, there are a lot of genes with low p-values and high log-fold changes that are barely called DE. Those “whiskers” are corrected for the denoised matrix.</p>
</blockquote>
<p>We can also see the number of differentially expressed genes has been reduced:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" title="1"><span class="kw">sum</span>(results.raw<span class="op">$</span>DE)</a>
<a class="sourceLine" id="cb24-2" title="2"><span class="co">#&gt; [1] 3810</span></a>
<a class="sourceLine" id="cb24-3" title="3"><span class="kw">sum</span>(results.denoised<span class="op">$</span>DE)</a>
<a class="sourceLine" id="cb24-4" title="4"><span class="co">#&gt; [1] 3347</span></a></code></pre></div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
